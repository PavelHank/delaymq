# 特性

`v1.0`@[hank](mailto:pavelhank@outlook.com)
---

## 1 延时消息
可以发布延时消息，支持任意延时时长，Producer 发布的延时消息，只有在到达延时的时间点之后，才会投递给 Consumer 处理。

## 2 订阅与发布
发布是指 Producer 向 Topic 中写入消息的过程。发布结束后，Topic 中的消息将会增加，而订阅指 Consumer 关注某个 Topic 下的消息，监听指定 Topic 的操作。

## 3 消息顺序
因为是延时消息，主要的输出顺序（Consumer 处理消息的顺序）与延时到期的绝对时间相关。比如消息A延时到 `2020.10.01 10:00:00` 处理， 消息B延时到 `2020.12.13 14:05:20` 处理， 那消息A在消息B之前，与消息A和消息B添加到 Broker 中的先后顺序无关。在我们集群内部消息先后顺序精确至毫秒级。

## 4 至少一次
每个延时消息，至少会被成功处理一次。Consumer先Pull消息到本地，消费完成后，才向服务器返回ack，如果没有消费一定不会ack消息，Consumer 消费消息后，将发送 Ack 确认消息消费完毕。如果客户端拉取了消息，却没有 Ack 成功消费，turtlemq 在一定时间之后（默认 1min）将把状态重置为可消费状态。

## 5 回溯消费
Broker 将会记录每个 Consumer 在订阅 Topic 中的消费进度，通过调整进度值可以回溯消费已消费信息。

## 6 消息重投
Producer 在产生消息时，如果发送失败会一直重试。而 Consumer 在消费消息失败之后（判断依据：服务端没有收到 Ack 应答），过一段时间就将状态重置为可消费状态，从而再次投放。我们会为每个消费者维护一个进度信息。